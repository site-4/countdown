<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Special+Elite&family=Pacifico&family=Bungee+Shade&family=Press+Start+2P&family=Permanent+Marker&family=Monoton&family=Righteous&display=swap" rel="stylesheet">
    
    <!-- Supabase Integration Required for Data Storage -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root { --m-x: 0; --m-y: 0; --theme-color: #fff; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { height: 100vh; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden; perspective: 1000px; }
        #bg-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; cursor: crosshair; }
        
        #countdown-container {
            text-align: center; padding: 40px; pointer-events: none; position: relative; z-index: 10;
            transform: rotateY(calc(var(--m-x) * 12deg)) rotateX(calc(var(--m-y) * -12deg));
            transition: transform 0.1s ease-out;
            display: flex; flex-direction: column; align-items: center;
        }

        .timer-display { font-size: 6rem; display: flex; gap: 20px; font-weight: bold; color: var(--theme-color); }
        .unit-box { display: flex; flex-direction: column; align-items: center; }
        .label { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 4px; margin-top: 10px; opacity: 0.7; }

        .subtitle {
            margin-top: 30px;
            font-size: 1.2rem;
            color: var(--theme-color);
            letter-spacing: 3px;
            text-transform: uppercase;
            opacity: 0.9;
            transition: all 0.5s ease;
        }

        /* Interactive Question Layer Styles */
        #unlock-sequence {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 600px; z-index: 100; display: none; text-align: center;
            color: white; font-family: 'Orbitron', sans-serif; background: rgba(0,0,0,0.8);
            padding: 40px; border: 2px solid var(--theme-color); border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .question-text { font-size: 1.5rem; margin-bottom: 30px; line-height: 1.4; color: var(--theme-color); }
        
        .btn-group { display: flex; gap: 20px; justify-content: center; }
        .action-btn { 
            padding: 15px 30px; border-radius: 10px; border: 2px solid var(--theme-color);
            background: transparent; color: white; cursor: pointer; text-transform: uppercase;
            font-family: 'Righteous', cursive; transition: all 0.3s;
        }
        .action-btn:hover { background: var(--theme-color); color: black; box-shadow: 0 0 20px var(--theme-color); }

        #response-input {
            width: 100%; padding: 15px; border-radius: 10px; border: 1px solid white;
            background: rgba(255,255,255,0.1); color: white; font-family: inherit;
            margin-top: 20px; resize: none;
        }

        /* Font Mappings */
        .f-0, .f-4, .f-7, .f-11, .f-12, .f-14, .f-16, .f-17 { font-family: 'Orbitron'; }
        .f-1, .f-15 { font-family: 'Special Elite'; }
        .f-2 { font-family: 'Pacifico'; }
        .f-3 { font-family: 'Bungee Shade'; }
        .f-5, .f-10 { font-family: 'Righteous'; }
        .f-6 { font-family: 'Press Start 2P'; }
        .f-8, .f-13 { font-family: 'Permanent Marker'; }
        .f-9 { font-family: 'Monoton'; }

        @media (max-width: 768px) { 
            .timer-display { font-size: 2.5rem; gap: 10px; } 
            .subtitle { font-size: 0.8rem; letter-spacing: 1px; }
            .question-text { font-size: 1.1rem; }
        }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>

    <!-- Master UI for Countdown -->
    <div id="countdown-container">
        <div class="timer-display" id="display-font-box">
            <div class="unit-box"><span id="days">00</span><div class="label">Days</div></div>
            <span>:</span>
            <div class="unit-box"><span id="hours">00</span><div class="label">Hrs</div></div>
            <span>:</span>
            <div class="unit-box"><span id="minutes">00</span><div class="label">Min</div></div>
            <span>:</span>
            <div class="unit-box"><span id="seconds">00</span><div class="label">Sec</div></div>
        </div>
        <div class="subtitle" id="subtitle-box">Something unforgettable unlocks at zero</div>
    </div>

    <!-- Interactive Terminal After Zero -->
    <div id="unlock-sequence">
        <div id="step-1">
            <div class="question-text">Do you want to receive it in person, or right now?</div>
            <div class="btn-group">
                <button class="action-btn" onclick="handleChoice('in_person')">In Person</button>
                <button class="action-btn" onclick="handleChoice('right_now')">Right Now</button>
            </div>
        </div>

        <div id="step-sure" style="display: none;">
            <div class="question-text">Are you sure?</div>
            <div class="btn-group">
                <button class="action-btn" onclick="handleConfirm(true)">Yes</button>
                <button class="action-btn" onclick="handleConfirm(false)">No</button>
            </div>
        </div>

        <div id="step-final" style="display: none;">
            <div class="question-text" id="final-proposal-text">
                If you are not doing anything this Saturday, I would like to go to the library with you to just do something together outside of school for the first time. 
                You can call it what you want: A date, a friend meeting, a study session, a hangout, or an adventure! But whatever you call it, I think it will be really fun! 
                <br><br>Do you want to go with me?
            </div>
            <textarea id="response-input" rows="3" placeholder="Type your answer here..."></textarea>
            <button class="action-btn" style="margin-top: 20px; width: 100%;" onclick="submitToSupabase()">Send Answer</button>
        </div>

        <div id="step-person-msg" style="display: none;">
            <div class="question-text">Okay! GO ask Derrick about it!</div>
            <button class="action-btn" onclick="location.reload()">Back</button>
        </div>

        <div id="step-completed" style="display: none;">
            <div class="question-text">Your response was sent!</div>
        </div>
    </div>

    <script>
        /**
         * SUPABASE CONFIGURATION
         * Replace the credentials below with your own project info
         */
        const SB_URL = 'https://yuymttkhmphzfesfsgna.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl1eW10dGtobXBoemZlc2ZzZ25hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3Nzg2MzcsImV4cCI6MjA4NDM1NDYzN30.zwvcoB9-t-UbNgmWkWQsgEc9gDbnnG4Kgi7tmK5HX60';
        const sb = supabase.createClient(SB_URL, SB_KEY);

        const targetDate = new Date('January 21, 2026 11:32:00').getTime();
        const root = document.documentElement;
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        
        let particles = [], manualIdx = -1, currentTheme = -1;
        let mouse = { x: 0, y: 0, rx: 0, ry: 0, down: false };
        let isComplete = false;

        class Part {
            constructor() { this.init(); }
            init() {
                this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height;
                this.vx = (Math.random()-0.5)*2; this.vy = (Math.random()-0.5)*2;
                this.s = Math.random()*3+1; this.z = Math.random()*canvas.width;
            }
        }

        function setup() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            particles = []; 
            let count = (currentTheme === 12 || currentTheme === 11) ? 100 : 150;
            if([0,7,5,16].includes(currentTheme)) count = 350;
            for(let i=0; i<count; i++) particles.push(new Part());
        }

        function draw() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            let b = mouse.down ? 4 : 1;
            const time = Date.now() * 0.001;

            switch(currentTheme) {
                case 17: ctx.fillStyle = '#000'; ctx.fillRect(0,0,canvas.width,canvas.height); particles.forEach(p => { p.x += Math.cos(p.y/100 + time) * 2; p.y += p.vy; if(p.y > canvas.height) p.y=0; ctx.fillStyle='#39ff14'; ctx.fillRect(p.x, p.y, 2, 10); }); break;              
                case 15: ctx.fillStyle = '#111'; ctx.fillRect(0,0,canvas.width,canvas.height); for(let i=0; i<20; i++) { ctx.strokeStyle = '#333'; ctx.beginPath(); ctx.arc(canvas.width/2+mouse.rx*0.1, canvas.height/2+mouse.ry*0.1, i*40 + (mouse.down?10:0), 0, 7); ctx.stroke(); } break;
                case 14: ctx.fillStyle = '#210101'; ctx.fillRect(0,0,canvas.width,canvas.height); particles.forEach(p => { p.y -= p.s*b; if(p.y<0) {p.y=canvas.height; p.x=Math.random()*canvas.width;} ctx.fillStyle=`hsl(${p.s*10}, 100%, 50%)`; ctx.fillRect(p.x, p.y, p.s, p.s); }); break;
                case 13: ctx.fillStyle = '#041a04'; ctx.fillRect(0,0,canvas.width,canvas.height); particles.forEach(p => { p.x += Math.sin(time + p.s); p.y -= 0.5; if(p.y<0) p.y=canvas.height; ctx.fillStyle='#4caf50aa'; ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(p.x+10,p.y+20); ctx.lineTo(p.x-10,p.y+20); ctx.fill(); }); break;
                case 1: ctx.fillStyle = 'rgba(0,0,0,0.1)'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle = '#0F0'; ctx.font = "20px monospace"; particles.forEach(p => { ctx.fillText(String.fromCharCode(0x30A0 + Math.random()*96), p.x, p.y); p.y += 20*b; if(p.y > canvas.height) p.y=0; }); break;
                case 11: ctx.fillStyle = '#020508'; ctx.fillRect(0,0,canvas.width,canvas.height); particles.forEach(p => { p.x += p.vx; p.y += p.vy; if(p.x < 0 || p.x > canvas.width) p.vx *= -1; if(p.y < 0 || p.y > canvas.height) p.vy *= -1; let d = Math.hypot(mouse.rx - p.x, mouse.ry - p.y); if(d < 250) { ctx.strokeStyle = `rgba(0, 255, 255, ${1 - d/250})`; ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(mouse.rx, mouse.ry); ctx.stroke(); } ctx.fillStyle = '#0ff'; ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, 7); ctx.fill(); }); break;
                case 10: ctx.fillStyle = '#001d3d'; ctx.fillRect(0,0,canvas.width,canvas.height); particles.forEach(p => { p.y -= p.s; if(p.y<0) p.y=canvas.height; ctx.strokeStyle='#0ff5'; ctx.beginPath(); ctx.arc(p.x+Math.sin(time+p.s)*20, p.y, p.s*5, 0, 7); ctx.stroke(); }); break;
                case 9: ctx.fillStyle = '#111'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.strokeStyle = '#d4af37'; for(let i=0; i<10; i++) { ctx.strokeRect(canvas.width/2 - i*50 + mouse.rx*0.05, canvas.height/2 - i*30, i*100, i*60); } break;
                case 8: if(mouse.down) { ctx.fillStyle=`hsl(${time*100}, 100%, 50%)`; ctx.beginPath(); ctx.arc(mouse.rx, mouse.ry, 20, 0, 7); ctx.fill(); } break;
                case 6: let id = ctx.createImageData(100,100); for(let i=0; i<id.data.length; i+=4) { id.data[i]=id.data[i+1]=id.data[i+2]=Math.random()*255; id.data[i+3]=100; } ctx.putImageData(id, mouse.rx%100, mouse.ry%100); break;
                case 5: ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.filter='blur(40px)'; for(let i=0; i<5; i++) { ctx.fillStyle=['#0f9','#0ff','#00f'][i%3]; ctx.beginPath(); ctx.ellipse(canvas.width/2, canvas.height/2 + Math.sin(time+i)*100, canvas.width, 100, Math.sin(time/2), 0, 7); ctx.fill(); } ctx.filter='none'; break;
                case 4: ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height); if(Math.random()>0.9) { ctx.fillStyle='#f0f2'; ctx.fillRect(Math.random()*canvas.width, 0, 50, canvas.height); } ctx.fillStyle='#0ff'; ctx.fillRect(mouse.rx-25, mouse.ry-25, 50, 50); break;
                case 3: ctx.fillStyle='#2e7d32'; ctx.fillRect(0,0,canvas.width,canvas.height); particles.forEach(p => { p.x += p.vx; p.y += p.vy; if(p.x<0||p.x>canvas.width) p.vx*=-1; let d = Math.hypot(mouse.rx-p.x, mouse.ry-p.y); ctx.fillStyle=`rgba(204,255,0,${Math.max(0, 1-d/300)})`; ctx.beginPath(); ctx.arc(p.x,p.y,40,0,7); ctx.fill(); }); break;
                case 2: ctx.fillStyle='#ff80ab'; ctx.fillRect(0,0,canvas.width,canvas.height); particles.forEach(p => { p.y -= p.s*b; if(p.y<0) p.y=canvas.height; ctx.fillStyle='#fff8'; ctx.font="30px serif"; ctx.fillText("â™¥", p.x, p.y); }); break;
                case 12: ctx.fillStyle='#3e2723'; ctx.fillRect(0,0,canvas.width,canvas.height); particles.forEach(p => { p.y += p.s; p.x += Math.sin(p.y/20); if(p.y>canvas.height) p.y=0; ctx.fillStyle='#f5f5dc22'; ctx.fillRect(p.x,p.y,40,50); }); break;

                // FALLBACK THEME (Replacing Pink Bubbly Case 16 with Starfield)
                case 16:
                case 7: 
                case 0: ctx.fillStyle = '#000'; ctx.fillRect(0,0,canvas.width,canvas.height); particles.forEach(p => { p.z -= (currentTheme===0 ? 1 : 15)*b; if(p.z<=0) p.z=canvas.width; let sx = (p.x-canvas.width/2)*(canvas.width/p.z)+canvas.width/2 + mouse.x*50; let sy = (p.y-canvas.height/2)*(canvas.width/p.z)+canvas.width/2 + mouse.y*50; ctx.fillStyle=`rgba(255,255,255,${1-p.z/canvas.width})`; ctx.beginPath(); ctx.arc(sx,sy,(1-p.z/canvas.width)*(currentTheme===0?10:3),0,7); ctx.fill(); }); break;
            }

            requestAnimationFrame(draw);
        }

        window.addEventListener('mousemove', e => {
            mouse.rx = e.clientX; mouse.ry = e.clientY; mouse.x = (e.clientX/window.innerWidth)*2-1; mouse.y = (e.clientY/window.innerHeight)*2-1;
            root.style.setProperty('--m-x', mouse.x); root.style.setProperty('--m-y', mouse.y);
        });
        window.addEventListener('mousedown', () => mouse.down = true);
        window.addEventListener('mouseup', () => mouse.down = false);
        window.addEventListener('keydown', e => { if(e.key==='2'){ manualIdx=(manualIdx===-1)?17:(manualIdx<=0?17:manualIdx-1); tick(); } });

        /**
         * INTERACTIVE LOGIC HANDLERS
         */
        const state = { choice: '', confirmed: false, answer: '' };

        function handleChoice(val) {
            state.choice = val;
            document.getElementById('step-1').style.display = 'none';
            if(val === 'in_person') {
                document.getElementById('step-person-msg').style.display = 'block';
                logChoiceOnly();
            } else {
                document.getElementById('step-sure').style.display = 'block';
            }
        }

        function handleConfirm(val) {
            state.confirmed = val;
            document.getElementById('step-sure').style.display = 'none';
            if(val) {
                document.getElementById('step-final').style.display = 'block';
            } else {
                document.getElementById('step-1').style.display = 'block';
            }
        }

        async function logChoiceOnly() {
            await sb.from('responses').insert({ choice: state.choice, confirmed: false, answer: 'In Person Selected' });
        }

        async function submitToSupabase() {
            state.answer = document.getElementById('response-input').value;
            if(!state.answer.trim()) return alert("Please type something! :)");
            
            const btn = document.querySelector('#step-final .action-btn');
            btn.innerText = "SENDING...";
            btn.disabled = true;

            const { error } = await sb.from('responses').insert({
                choice: state.choice,
                confirmed: state.confirmed,
                answer: state.answer
            });

            if(!error) {
                document.getElementById('step-final').style.display = 'none';
                document.getElementById('step-completed').style.display = 'block';
            } else {
                alert("Error sending response. Please try again.");
                btn.innerText = "Send Answer to Derrick";
                btn.disabled = false;
            }
        }

        function triggerUnlock() {
            if(isComplete) return;
            isComplete = true;
            document.getElementById('countdown-container').style.display = 'none';
            document.getElementById('unlock-sequence').style.display = 'block';
        }

        function tick() {
            const diff = targetDate - Date.now(), d = Math.max(0, Math.floor(diff/86400000));
            
            // Check for Countdown End
            if(diff <= 0) {
                triggerUnlock();
            }

            document.getElementById('days').innerText = String(d).padStart(2,'0');
            document.getElementById('hours').innerText = String(Math.max(0,Math.floor((diff%86400000)/3600000))).padStart(2,'0');
            document.getElementById('minutes').innerText = String(Math.max(0,Math.floor((diff%3600000)/60000))).padStart(2,'0');
            document.getElementById('seconds').innerText = String(Math.max(0,Math.floor((diff%60000)/1000))).padStart(2,'0');
            
            let idx = manualIdx!==-1?manualIdx:d; idx=Math.max(0,Math.min(17,idx));
            if(currentTheme!==idx){ 
                currentTheme=idx; setup(); 
                document.getElementById('display-font-box').className = `timer-display f-${idx}`;
                document.getElementById('subtitle-box').className = `subtitle f-${idx}`;
                root.style.setProperty('--theme-color', [9,11,12,17,0,7,16].includes(idx)?'#fff':(idx===6?'#39ff14':'#fff'));
            }
        }
        
        window.addEventListener('resize', setup); setup(); draw(); setInterval(tick, 1000); tick();
    </script>
</body>
</html>
